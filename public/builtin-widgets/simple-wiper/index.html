<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script defer src="../syncer.js"></script>
    <style>
        body {
            height: 100vh;
            display: grid;
            place-items: center;
            background-color: #f1f5f9;
            margin: 0;
            user-select: none;
        }
        #simulator-container {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="simulator-container">
        <iframe id="wiper" src="https://playground-plugins.netlify.app/simulator/wiper-iframe/" frameborder="0"
            style="width:100%;height:100%"></iframe>
    </div>

    <script>
        let interval = null;

        function onWidgetLoaded(options) {
            const API_NAME = options.api || "Vehicle.Body.Windshield.Front.Wiping.Mode";

            //console.log("API_NAME: ", API_NAME);

            interval = setInterval(() => {
                let apiValueObject = getApiValue(API_NAME);
                let apiValue = apiValueObject?.value || "OFF";

                //console.log("API_VALUE: ", apiValue);

                const wiperIframe = document.getElementById("wiper");

                if (apiValue === "MEDIUM") {
                    wiperIframe.contentWindow.postMessage("LO", "*");
                } else if (apiValue === "OFF") {
                    wiperIframe.contentWindow.postMessage("OFF", "*");
                }
            }, options.dataUpdateInterval || 1000); // Default to 1 second if not provided
        }

        function onWidgetUnloaded(options) {
            if (interval) clearInterval(interval);
        }
    </script>
</body>

</html>